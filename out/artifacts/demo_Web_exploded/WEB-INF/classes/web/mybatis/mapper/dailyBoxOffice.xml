<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dailyBoxOffice">
    <insert id="movielist" parameterType="web.mybatis.vo.DailyBoxOfficeVO">INSERT INTO daily_boxoffice( boxofficeType,
        showRange, rnum, `rank`, rankOldAndNew, movieCd, movieNm, openDt, salesAmt, salesShare, salesAcc, audiCnt,
        audiAcc, scrnCnt, showCnt) VALUES( #{boxofficeType}, #{showRange}, #{rnum}, #{rank}, #{rankOldAndNew},
        #{movieCd}, #{movieNm}, #{openDt}, #{salesAmt}, #{salesShare},#{salesAcc}, #{audiCnt}, #{audiAcc},#{scrnCnt},
        #{showCnt})
    </insert>
    <select id="check" parameterType="String" resultType="int">SELECT count(*) FROM daily_boxoffice WHERE movieCd =
        #{movieCd}
    </select>
    <update id="updateMovie" parameterType="web.mybatis.vo.DailyBoxOfficeVO">UPDATE daily_boxoffice SET boxofficeType =
        #{boxofficeType}, showRange = #{showRange}, rnum = #{rnum}, `rank` = #{rank}, rankOldAndNew = #{rankOldAndNew},
        movieCd = #{movieCd}, movieNm = #{movieNm}, openDt = #{openDt}, salesAmt = #{salesAmt}, salesShare =
        #{salesShare}, salesAcc = #{salesAcc}, audiCnt = #{audiCnt}, audiAcc = #{audiAcc}, scrnCnt = #{scrnCnt}, showCnt
        = #{showCnt} WHERE movieCd = #{movieCd}
    </update>
    <!--   전체 영화 수   -->
    <select id="count" resultType="int">SELECT COUNT(*) FROM daily_boxoffice</select>
    <!--   영화이름으로 검색한 영화 수   -->
    <select id="searchcount" resultType="int" parameterType="String">SELECT COUNT(*) FROM daily_boxoffice AND movieNm
        LIKE CONCAT('%',#{movieNm},'%')
    </select>
    <resultMap type="web.mybatis.vo.DailyBoxOfficeVO" id="map1">
        <!--   기본키설정   -->
        <id property="idx" column="idx"/>
        <result property="boxofficeType" column="boxofficeType"/>
        <result property="showRange" column="showRange"/>
        <result property="rnum" column="rnum"/>
        <result property="rank" column="rank"/>
        <result property="rankOldAndNew" column="rankOldAndNew"/>
        <result property="movieCd" column="movieCd"/>
        <result property="movieNm" column="movieNm"/>
        <result property="openDt" column="openDt"/>
        <result property="salesAmt" column="salesAmt"/>
        <result property="salesShare" column="salesShare"/>
        <result property="salesAcc" column="salesAcc"/>
        <result property="audiCnt" column="audiCnt"/>
        <result property="audiAcc" column="audiAcc"/>
        <result property="scrnCnt" column="scrnCnt"/>
        <result property="showCnt" column="showCnt"/>
    </resultMap>
    <!--   공지사항  -->
    <select id="list" resultMap="map1" parameterType="Map">
        SELECT * FROM( SELECT @RN:=@RN+1 AS rnum1, a.* FROM( SELECT * FROM daily_boxoffice
        <if test="movieNm != null"> AND movieNm LIKE CONCAT('%', #{movieNm}, '%')</if>
        ORDER BY idx ASC ) a, (SELECT @RN:=0) b ) c WHERE c.rnum between #{begin} AND #{end};
    </select>
</mapper>